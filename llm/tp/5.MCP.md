---
author:
- François Rioult
lang: fr
title: Application des LLM 
subtitle: TP : MCP
---

On met en oeuvre MCP avec `AnythingLLM` :

Le fichier `~/.config/anythingllm-desktop/storage/plugins/anythingllm_mcp_servers.json` contient la liste des services MCP :

```json
{
  "mcpServers": {
      "time": {
          "command": "uvx",
          "args": [
              "mcp-server-time",
              "--local-timezone=America/New_York"
          ]
      },
      "memory": {
          "command": "npx",
          "args": [
              "-y",
              "@modelcontextprotocol/server-memory"
          ]
      },
      "mcp": {
          "command": "mcp",
          "args": [
              "run",
              "mcp-server-demo.py"
          ]
      }
  }
}
```

# Pré-recquis

* installer `uv`, le gestionnaire d'environnement pour `python`
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh

```

# Serveur MCP

* configurer l'environnement :

```bash
# initialisation répertoire
uv init mcp-server-demo
cd mcp-server-demo/
# création environnement
uv add "mcp[cli]"
# activer l'environnement
source .venv/bin/activate
```

* configurer le serveur, dans [config.json](script/mcp-server-demo/config.json)

* définir le code du serveur dans [`mcp-server-demo.py`](script/mcp-server-demo/) :

```python
# server.py
from mcp.server.fastmcp import FastMCP

# Create an MCP server
mcp = FastMCP("Demo")

# Add an addition tool
@mcp.tool()
def add(a: int, b: int) -> int:
    """Add two numbers"""
    return a + b

@mcp.tool()
def level(sensor: int) -> str:
    """Returns the level at given sensor"""
    if sensor == 1:
        return {"level":10.0}
    return {"level":24.0}

# Add a dynamic greeting resource
@mcp.resource("greeting://{name}")
def get_greeting(name: str) -> str:
    """Get a personalized greeting"""
    return f"Hello, {name}!"
```

* exécuter le serveur

        mcp dev mcp-server-demo.py


Le navigateur ouvre la page <http://127.0.0.1:6274> qui permet de tester le serveur. Une fois connecté, on peut tester les outils à l'aide de formulaires.

## Intégration `AnythingLLM`

**The server has to be launched in the correct environment.**

* se positionner dans le répertoire contenant le code des outils

        source .venv/bin/activate

* lancer `AnythingLLM`

/home/rioultf/.config/anythingllm-desktop/storage/plugins